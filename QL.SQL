CREATE DATABASE QLKS

CREATE TABLE KHACHHANG
(
	MAKH  INT IDENTITY(1,1) PRIMARY KEY, --Khóa chính
	HOTEN Nvarchar(40),
	TENTK VARCHAR(40),
	MATKHAU VARCHAR(20),
	TUOI INT,
	SDT VARCHAR(12),
)

CREATE TABLE PHONG
(
	MAPHONG INT IDENTITY(1,1) PRIMARY KEY,
	TENPHONG NVARCHAR(20),
	TRANGTHAI NVARCHAR(20),
	MALP INT
)

CREATE TABLE LOAIPHONG
(
	MALP INT IDENTITY(1,1) PRIMARY KEY,
	TENLP VARCHAR(20),
	GIA MONEY
)

CREATE TABLE DICHVU
(
	MADV INT IDENTITY(1,1) PRIMARY KEY,
	TENDV NVARCHAR(20),
	GIA MONEY,
)

CREATE TABLE HOADON
(
	MAHD INT IDENTITY(1,1) PRIMARY KEY,
	NGAYLAP SMALLDATETIME,
	HINHTHUCTT VARCHAR(20),
	TINHTIEN MONEY,
	MAKH INT,
)

CREATE TABLE THUE
(
	MAKH INT,
	MAPHONG INT,
	CONSTRAINT FK_THUE PRIMARY KEY( MAPHONG,MAKH),
	NGAYDEN SMALLDATETIME,
	NGAYDI SMALLDATETIME,
	THANHTOAN NVARCHAR(20),
)

CREATE TABLE DATPHONG
(
	MAKH INT,
	MAPHONG INT,
	CONSTRAINT FK_DATPHONG PRIMARY KEY( MAPHONG,MAKH),
	NGAYDAT SMALLDATETIME,
	TIENDAT MONEY,
)

CREATE TABLE DOIPHONG
(
	MAKH INT,
	NGAYDOI SMALLDATETIME,
	MAPCU INT,
	MAPMOI INT,
	CONSTRAINT FK_DOIPHONG PRIMARY KEY(MAKH,MAPMOI,MAPCU) 
)

CREATE TABLE DANHGIA
(
	MADG INT IDENTITY(1,1) PRIMARY KEY,
	MAKH INT,
	SAO TINYINT,
	BINHLUAN NVARCHAR(40)
)

ALTER TABLE PHONG ADD CONSTRAINT FK_MALP FOREIGN KEY (MALP) REFERENCES LOAIPHONG(MALP)
ALTER TABLE THUE ADD CONSTRAINT FK_MAKH FOREIGN KEY (MAKH) REFERENCES KHACHHANG (MAKH)
ALTER TABLE THUE ADD CONSTRAINT FK_MAPHONG FOREIGN KEY (MAPHONG) REFERENCES PHONG(MAPHONG)
ALTER TABLE DATPHONG ADD CONSTRAINT DP_MAKH FOREIGN KEY (MAKH) REFERENCES KHACHHANG (MAKH)
ALTER TABLE DATPHONG ADD CONSTRAINT DP_MAPHONG FOREIGN KEY (MAPHONG) REFERENCES PHONG(MAPHONG) 
ALTER TABLE DOIPHONG ADD CONSTRAINT DOI_MAKH FOREIGN KEY (MAKH) REFERENCES KHACHHANG (MAKH) 
ALTER TABLE DOIPHONG ADD CONSTRAINT FK_MAPCU FOREIGN KEY (MAPCU) REFERENCES PHONG(MAPHONG) 
ALTER TABLE DOIPHONG ADD CONSTRAINT FK_MAPMOI FOREIGN KEY (MAPMOI) REFERENCES PHONG(MAPHONG) 
ALTER TABLE DANHGIA ADD CONSTRAINT DG_MAKH FOREIGN KEY (MAKH) REFERENCES KHACHHANG (MAKH) 
ALTER TABLE HOADON ADD CONSTRAINT HD_MAKH FOREIGN KEY (MAKH) REFERENCES KHACHHANG (MAKH) 

ALTER TABLE KHACHHANG ADD CMND VARCHAR(20)

ALTER TABLE PHONG ADD CONSTRAINT CHK_TRANGTHAI CHECK (TRANGTHAI IN(N'TRỐNG',N'ĐÃ THUÊ'))
ALTER TABLE DANHGIA ADD CONSTRAINT CHK_SAO CHECK (SAO BETWEEN 1 AND 5)
ALTER TABLE THUE ADD CONSTRAINT CHK_NGAYDI CHECK (NGAYDI>NGAYDEN)

INSERT INTO KHACHHANG(TENTK,MATKHAU) VALUES ('ADMIN','123456')

---ĐĂNG NHẬP
SELECT TENTK,MATKHAU
FROM KHACHHANG

--ĐỔI MẬT KHẨU
UPDATE KHACHHANG
SET MATKHAU=''--GIÁ TRỊ MẬT KHẨU LẤY TỪ WINFORM
WHERE TENTK=''--GIÁ TRỊ  TENTK LẤY TỪ WINFORM
	
--ĐĂNG KÍ
SELECT COUNT(MAKH) FROM KHACHHANG
-->LẤY SỐ LƯỢNG MAKH ĐỀ TẠO MAKH KẾ TIẾP 
INSERT INTO KHACHHANG VALUES ('','','','','','','')
-->ĐIỀN CÁC GIÁ TRỊ LẤY TỪ WINFORM

--TÌM PHÒNG 
SELECT MAPHONG,TENPHONG,TENLP,TRANGTHAI
FROM PHONG INNER JOIN LOAIPHONG
ON PHONG.MALP=LOAIPHONG.MALP AND MAPHONG=''
-->TÊN MAPHONG LẤY TỪ WINFORM

