CREATE DATABASE QLKS

CREATE TABLE KHACHHANG
(
	MAKH  INT IDENTITY(1,1) PRIMARY KEY, --Khóa chính
	HOTEN Nvarchar(40),
	TENTK VARCHAR(40),
	MATKHAU VARCHAR(20),
	TUOI INT,
	SDT VARCHAR(12),
)

CREATE TABLE PHONG
(
	MAPHONG VARCHAR(5) PRIMARY KEY,
	TENPHONG NVARCHAR(20),
	TRANGTHAI NVARCHAR(20),
	MALP VARCHAR(3)
)

CREATE TABLE LOAIPHONG
(
	MALP VARCHAR(3) PRIMARY KEY,
	TENLP NVARCHAR(20),
	GIA MONEY
)

CREATE TABLE DICHVU
(
	MADV VARCHAR(5) PRIMARY KEY,
	TENDV NVARCHAR(20),
	GIA MONEY,
)

CREATE TABLE HOADON
(
	MAHD VARCHAR(5) PRIMARY KEY,
	NGAYLAP SMALLDATETIME,
	HINHTHUCTT VARCHAR(20),
	TINHTIEN MONEY,
	MAKH INT,
)

CREATE TABLE THUE
(
	MAKH INT,
	MAPHONG VARCHAR(5),
	PRIMARY KEY( MAPHONG,MAKH),
	NGAYDEN SMALLDATETIME,
	NGAYDI SMALLDATETIME,
	THANHTOAN NVARCHAR(20),
)

CREATE TABLE DATPHONG
(
	MAKH INT,
	MAPHONG VARCHAR(5),
	CONSTRAINT FK_DATPHONG PRIMARY KEY( MAPHONG,MAKH),
	NGAYDAT SMALLDATETIME,
	TIENDAT MONEY,
)

CREATE TABLE DOIPHONG
(
	MAKH INT,
	NGAYDOI SMALLDATETIME,
	MAPCU VARCHAR(5),
	MAPMOI VARCHAR(5),
	CONSTRAINT FK_DOIPHONG PRIMARY KEY(MAKH,MAPMOI,MAPCU) 
)

CREATE TABLE DANHGIA
(
	MADG INT IDENTITY(1,1) PRIMARY KEY,
	MAKH INT,
	SAO TINYINT,
	BINHLUAN NVARCHAR(40)
)

CREATE TABLE DOANHTHU
(
	DOANHTHU MONEY,
	NAM SMALLINT,
)

ALTER TABLE PHONG ADD CONSTRAINT FK_MALP FOREIGN KEY (MALP) REFERENCES LOAIPHONG(MALP)
ALTER TABLE THUE ADD CONSTRAINT FK_MAKH FOREIGN KEY (MAKH) REFERENCES KHACHHANG (MAKH)
ALTER TABLE THUE ADD CONSTRAINT FK_MAPHONG FOREIGN KEY (MAPHONG) REFERENCES PHONG(MAPHONG)
ALTER TABLE DATPHONG ADD CONSTRAINT DP_MAKH FOREIGN KEY (MAKH) REFERENCES KHACHHANG (MAKH)
ALTER TABLE DATPHONG ADD CONSTRAINT DP_MAPHONG FOREIGN KEY (MAPHONG) REFERENCES PHONG(MAPHONG) 
ALTER TABLE DOIPHONG ADD CONSTRAINT DOI_MAKH FOREIGN KEY (MAKH) REFERENCES KHACHHANG (MAKH) 
ALTER TABLE DOIPHONG ADD CONSTRAINT FK_MAPCU FOREIGN KEY (MAPCU) REFERENCES PHONG(MAPHONG) 
ALTER TABLE DOIPHONG ADD CONSTRAINT FK_MAPMOI FOREIGN KEY (MAPMOI) REFERENCES PHONG(MAPHONG) 
ALTER TABLE DANHGIA ADD CONSTRAINT DG_MAKH FOREIGN KEY (MAKH) REFERENCES KHACHHANG (MAKH) 
ALTER TABLE HOADON ADD CONSTRAINT HD_MAKH FOREIGN KEY (MAKH) REFERENCES KHACHHANG (MAKH) 

ALTER TABLE KHACHHANG ADD CMND VARCHAR(20)

ALTER TABLE PHONG ADD CONSTRAINT CHK_TRANGTHAI CHECK (TRANGTHAI IN(N'TRỐNG',N'ĐÃ THUÊ'))
ALTER TABLE DANHGIA ADD CONSTRAINT CHK_SAO CHECK (SAO BETWEEN 1 AND 5)
ALTER TABLE THUE ADD CONSTRAINT CHK_NGAYDI CHECK (NGAYDI > NGAYDEN)


INSERT INTO KHACHHANG(TENTK,MATKHAU) VALUES ('ADMIN','123456')

-------------------------------------------------NHAP LOAI PHONG-------------------------------------------

INSERT INTO LOAIPHONG(MALP, TENLP, GIA) VALUES ('RST', N'Phòng tổng thống', '50,000,000')
INSERT INTO LOAIPHONG(MALP, TENLP, GIA) VALUES ('VIP', N'Phòng VIP', '10,000,000')
INSERT INTO LOAIPHONG(MALP, TENLP, GIA) VALUES ('NRM', N'Phòng phổ thông', '5,000,000')

-------------------------------------------------NHAP SO PHONG-------------------------------------------

INSERT INTO PHONG(MAPHONG,TENPHONG,TRANGTHAI,MALP) VALUES ('TT1',N'TỔNG THỐNG 1', N'Trống', 'RST') 
INSERT INTO PHONG(MAPHONG,TENPHONG,TRANGTHAI,MALP) VALUES ('TT2',N'TỔNG THỐNG 2', N'Trống', 'RST') 

INSERT INTO PHONG(MAPHONG,TENPHONG,TRANGTHAI,MALP) VALUES ('VIP1',N'V.I.P 1', N'Trống', 'VIP') 
INSERT INTO PHONG(MAPHONG,TENPHONG,TRANGTHAI,MALP) VALUES ('VIP2',N'V.I.P 2', N'Trống', 'VIP') 
INSERT INTO PHONG(MAPHONG,TENPHONG,TRANGTHAI,MALP) VALUES ('VIP3',N'V.I.P 3', N'Trống', 'VIP') 
INSERT INTO PHONG(MAPHONG,TENPHONG,TRANGTHAI,MALP) VALUES ('VIP4',N'V.I.P 4', N'Trống', 'VIP') 
INSERT INTO PHONG(MAPHONG,TENPHONG,TRANGTHAI,MALP) VALUES ('VIP5',N'V.I.P 5', N'Trống', 'VIP') 
INSERT INTO PHONG(MAPHONG,TENPHONG,TRANGTHAI,MALP) VALUES ('VIP6',N'V.I.P 6', N'Trống', 'VIP') 
INSERT INTO PHONG(MAPHONG,TENPHONG,TRANGTHAI,MALP) VALUES ('VIP7',N'V.I.P 7', N'Trống', 'VIP') 
INSERT INTO PHONG(MAPHONG,TENPHONG,TRANGTHAI,MALP) VALUES ('VIP8',N'V.I.P 8', N'Trống', 'VIP') 
INSERT INTO PHONG(MAPHONG,TENPHONG,TRANGTHAI,MALP) VALUES ('VIP9',N'V.I.P 9', N'Trống', 'VIP') 
INSERT INTO PHONG(MAPHONG,TENPHONG,TRANGTHAI,MALP) VALUES ('VIP10',N'V.I.P 10', N'Trống', 'VIP') 

INSERT INTO PHONG(MAPHONG,TENPHONG,TRANGTHAI,MALP) VALUES ('PT1',N'PHỔ THÔNG 1', N'Trống', 'NRM') 
INSERT INTO PHONG(MAPHONG,TENPHONG,TRANGTHAI,MALP) VALUES ('PT2',N'PHỔ THÔNG 2', N'Trống', 'NRM') 
INSERT INTO PHONG(MAPHONG,TENPHONG,TRANGTHAI,MALP) VALUES ('PT3',N'PHỔ THÔNG 3', N'Trống', 'NRM') 
INSERT INTO PHONG(MAPHONG,TENPHONG,TRANGTHAI,MALP) VALUES ('PT4',N'PHỔ THÔNG 4', N'Trống', 'NRM') 
INSERT INTO PHONG(MAPHONG,TENPHONG,TRANGTHAI,MALP) VALUES ('PT5',N'PHỔ THÔNG 5', N'Trống', 'NRM') 
INSERT INTO PHONG(MAPHONG,TENPHONG,TRANGTHAI,MALP) VALUES ('PT6',N'PHỔ THÔNG 6', N'Trống', 'NRM') 
INSERT INTO PHONG(MAPHONG,TENPHONG,TRANGTHAI,MALP) VALUES ('PT7',N'PHỔ THÔNG 7', N'Trống', 'NRM') 
INSERT INTO PHONG(MAPHONG,TENPHONG,TRANGTHAI,MALP) VALUES ('PT8',N'PHỔ THÔNG 8', N'Trống', 'NRM') 
INSERT INTO PHONG(MAPHONG,TENPHONG,TRANGTHAI,MALP) VALUES ('PT9',N'PHỔ THÔNG 9', N'Trống', 'NRM') 
INSERT INTO PHONG(MAPHONG,TENPHONG,TRANGTHAI,MALP) VALUES ('PT10',N'PHỔ THÔNG 10', N'Trống', 'NRM') 
INSERT INTO PHONG(MAPHONG,TENPHONG,TRANGTHAI,MALP) VALUES ('PT11',N'PHỔ THÔNG 11', N'Trống', 'NRM') 
INSERT INTO PHONG(MAPHONG,TENPHONG,TRANGTHAI,MALP) VALUES ('PT12',N'PHỔ THÔNG 12', N'Trống', 'NRM') 
INSERT INTO PHONG(MAPHONG,TENPHONG,TRANGTHAI,MALP) VALUES ('PT13',N'PHỔ THÔNG 13', N'Trống', 'NRM') 
INSERT INTO PHONG(MAPHONG,TENPHONG,TRANGTHAI,MALP) VALUES ('PT14',N'PHỔ THÔNG 14', N'Trống', 'NRM') 
INSERT INTO PHONG(MAPHONG,TENPHONG,TRANGTHAI,MALP) VALUES ('PT15',N'PHỔ THÔNG 15', N'Trống', 'NRM') 

SELECT *
FROM PHONG
ORDER BY 

---ĐĂNG NHẬP
SELECT TENTK,MATKHAU
FROM KHACHHANG

--ĐỔI MẬT KHẨU
UPDATE KHACHHANG
SET MATKHAU=''--GIÁ TRỊ MẬT KHẨU LẤY TỪ WINFORM
WHERE TENTK=''--GIÁ TRỊ  TENTK LẤY TỪ WINFORM
	
--ĐĂNG KÍ
SELECT COUNT(MAKH) FROM KHACHHANG
-->LẤY SỐ LƯỢNG MAKH ĐỀ TẠO MAKH KẾ TIẾP 
INSERT INTO KHACHHANG VALUES ('','','','','','','')
-->ĐIỀN CÁC GIÁ TRỊ LẤY TỪ WINFORM

--TÌM PHÒNG 
SELECT MAPHONG,TENPHONG,TENLP,TRANGTHAI
FROM PHONG INNER JOIN LOAIPHONG
ON PHONG.MALP=LOAIPHONG.MALP AND MAPHONG=''
-->TÊN MAPHONG LẤY TỪ WINFORM

--DOANH THU
UPDATE DOANHTHU
SET DOANHTHU = (SELECT SUM(TINHTIEN) FROM HOADON WHERE DOANHTHU.NAM = YEAR(HOADON.NGAYLAP))


